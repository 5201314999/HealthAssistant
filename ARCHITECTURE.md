# é¡¹ç›®æ¶æ„è¯´æ˜

## ğŸ“ ç³»ç»Ÿæ¶æ„

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·ç•Œé¢å±‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Index.ets                    â”‚  é¦–é¡µ - æ¨¡æ¿åˆ—è¡¨           â”‚
â”‚  DiseaseManagePage.ets        â”‚  é€šç”¨ç–¾ç—…ç®¡ç†é¡µé¢          â”‚
â”‚  DataEntryPage.ets            â”‚  é€šç”¨æ•°æ®å½•å…¥é¡µé¢          â”‚
â”‚  MedicineManagePage.ets       â”‚  ç”¨è¯ç®¡ç†é¡µé¢             â”‚
â”‚  AddMedicinePage.ets          â”‚  æ·»åŠ è¯å“é¡µé¢             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä¸šåŠ¡é€»è¾‘å±‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  BuiltInTemplates             â”‚  å†…ç½®æ¨¡æ¿é…ç½®             â”‚
â”‚  HealthDataManager            â”‚  å¥åº·æ•°æ®ç®¡ç†å™¨           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ•°æ®æ¨¡å‹å±‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  DiseaseTemplate              â”‚  ç–¾ç—…æ¨¡æ¿å®šä¹‰             â”‚
â”‚  IndicatorDefinition          â”‚  æŒ‡æ ‡å®šä¹‰                â”‚
â”‚  IndicatorGroup               â”‚  æŒ‡æ ‡ç»„å®šä¹‰              â”‚
â”‚  HealthRecord                 â”‚  å¥åº·è®°å½•                â”‚
â”‚  MedicineData                 â”‚  è¯å“æ•°æ®                â”‚
â”‚  MedicineRecord               â”‚  ç”¨è¯è®°å½•                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ•°æ®æŒä¹…å±‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Preferences API              â”‚  HarmonyOS æœ¬åœ°å­˜å‚¨       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ é‡æ„å¯¹æ¯”

### Beforeï¼ˆæ—§æ¶æ„ï¼‰âŒ

```
ç–¾ç—…ç®¡ç†
â”œâ”€â”€ ThyroidManagePage.ets        // ç”²äº¢ç®¡ç†é¡µé¢
â”œâ”€â”€ ThyroidDataEntryPage.ets     // ç”²äº¢å½•å…¥é¡µé¢
â”œâ”€â”€ DiabetesManagePage.ets       // ç³–å°¿ç—…ç®¡ç†é¡µé¢
â”œâ”€â”€ DiabetesDataEntryPage.ets    // ç³–å°¿ç—…å½•å…¥é¡µé¢
â””â”€â”€ ...æ›´å¤šç–¾ç—…éœ€è¦æ›´å¤šé¡µé¢
```

**é—®é¢˜ï¼š**

- âŒ æ¯ä¸ªç–¾ç—…éœ€è¦ 2 ä¸ªé¡µé¢ï¼ˆå…± 4 ä¸ªæ–‡ä»¶ï¼‰
- âŒ å¤§é‡é‡å¤ä»£ç 
- âŒ æ·»åŠ æ–°ç–¾ç—…éœ€è¦å†™å¾ˆå¤šä»£ç 
- âŒ éš¾ä»¥ç»´æŠ¤å’Œæ‰©å±•

### Afterï¼ˆæ–°æ¶æ„ï¼‰âœ…

```
é€šç”¨ç³»ç»Ÿ
â”œâ”€â”€ DiseaseManagePage.ets        // ä¸€ä¸ªé¡µé¢ç®¡ç†æ‰€æœ‰ç–¾ç—…
â”œâ”€â”€ DataEntryPage.ets            // ä¸€ä¸ªé¡µé¢å½•å…¥æ‰€æœ‰æ•°æ®
â””â”€â”€ BuiltInTemplates.ets         // é…ç½®æ–‡ä»¶æ·»åŠ æ–°ç–¾ç—…
```

**ä¼˜åŠ¿ï¼š**

- âœ… 2 ä¸ªé€šç”¨é¡µé¢é€‚é…æ‰€æœ‰ç–¾ç—…
- âœ… ä»£ç é‡å‡å°‘ 70%+
- âœ… æ·»åŠ æ–°ç–¾ç—…åªéœ€é…ç½®æ¨¡æ¿
- âœ… æ˜“äºç»´æŠ¤å’Œæ‰©å±•

## ğŸ¯ æ ¸å¿ƒè®¾è®¡æ¨¡å¼

### 1. æ¨¡æ¿æ¨¡å¼ï¼ˆTemplate Patternï¼‰

`DiseaseTemplate` å®šä¹‰ç–¾ç—…ç®¡ç†çš„æŠ½è±¡ç»“æ„ï¼š

```typescript
DiseaseTemplate {
  id: string              // æ¨¡æ¿å”¯ä¸€æ ‡è¯†
  name: string            // æ¨¡æ¿åç§°
  color: string           // ä¸»é¢˜é¢œè‰²
  indicatorGroups: []     // æŒ‡æ ‡ç»„åˆ—è¡¨
}
```

### 2. ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰

ä¸åŒç±»å‹çš„æŒ‡æ ‡ä½¿ç”¨ä¸åŒçš„æ¸²æŸ“å’ŒéªŒè¯ç­–ç•¥ï¼š

```typescript
IndicatorType {
  NUMBER,   // ç­–ç•¥1: æ•°å€¼è¾“å…¥ + èŒƒå›´éªŒè¯
  SELECT,   // ç­–ç•¥2: ä¸‹æ‹‰é€‰æ‹©
  TEXT      // ç­–ç•¥3: æ–‡æœ¬è¾“å…¥
}
```

### 3. å·¥å‚æ¨¡å¼ï¼ˆFactory Patternï¼‰

`BuiltInTemplates` ä½œä¸ºå·¥å‚åˆ›å»ºå„ç§ç–¾ç—…æ¨¡æ¿ï¼š

```typescript
BuiltInTemplates.getTemplateById("thyroid"); // åˆ›å»ºç”²äº¢æ¨¡æ¿
BuiltInTemplates.getTemplateById("diabetes"); // åˆ›å»ºç³–å°¿ç—…æ¨¡æ¿
```

### 4. å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰

`HealthDataManager` ä½¿ç”¨å•ä¾‹ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼š

```typescript
HealthDataManager.getInstance();
```

## ğŸ“¦ æ¨¡å—èŒè´£

### æ•°æ®æ¨¡å‹æ¨¡å—

**DiseaseTemplate.ets**

- å®šä¹‰ç–¾ç—…æ¨¡æ¿ç»“æ„
- å®šä¹‰æŒ‡æ ‡å’ŒæŒ‡æ ‡ç»„
- å®šä¹‰å¥åº·è®°å½•æ ¼å¼

**MedicineData.ets**

- å®šä¹‰è¯å“æ•°æ®ç»“æ„
- å®šä¹‰ç”¨è¯è®°å½•ç»“æ„

### é…ç½®æ¨¡å—

**BuiltInTemplates.ets**

- åˆ›å»ºå†…ç½®æ¨¡æ¿ï¼ˆç”²äº¢ã€ç³–å°¿ç—…ï¼‰
- ç®¡ç†æ¨¡æ¿æ³¨å†Œ
- æ”¯æŒè‡ªå®šä¹‰æ¨¡æ¿æ‰©å±•

### æ•°æ®ç®¡ç†æ¨¡å—

**HealthDataManager.ets**

- å¥åº·è®°å½• CRUD æ“ä½œ
- è¯å“ç®¡ç† CRUD æ“ä½œ
- ç”¨è¯è®°å½•ç®¡ç†
- æ•°æ®æŒä¹…åŒ–

### é¡µé¢æ¨¡å—

**Index.ets**

- æ˜¾ç¤ºæ‰€æœ‰æ¨¡æ¿å¡ç‰‡
- ç»Ÿè®¡æ•°æ®å±•ç¤º
- å¯¼èˆªå…¥å£

**DiseaseManagePage.ets**

- æ ¹æ®æ¨¡æ¿ ID åŠ è½½æ•°æ®
- åŠ¨æ€æ¸²æŸ“æŒ‡æ ‡ç»„
- æ”¯æŒ Tab åˆ‡æ¢
- æ•°æ®åˆ é™¤æ“ä½œ

**DataEntryPage.ets**

- åŠ¨æ€ç”Ÿæˆè¡¨å•
- æ ¹æ®æŒ‡æ ‡ç±»å‹æ¸²æŸ“æ§ä»¶
- æ•°æ®éªŒè¯
- ä¿å­˜è®°å½•

**MedicineManagePage.ets**

- ä»Šæ—¥ç”¨è¯æ‰“å¡
- è¯å“åˆ—è¡¨ç®¡ç†
- Tab åˆ‡æ¢

**AddMedicinePage.ets**

- è¯å“ä¿¡æ¯å½•å…¥
- ç”¨è¯å‘¨æœŸè®¾ç½®
- æœç”¨æ—¶é—´é…ç½®

## ğŸ” æ•°æ®æµ

### 1. è¯»å–æ•°æ®æµ

```
ç”¨æˆ·æ‰“å¼€é¡µé¢
    â†“
é¡µé¢è·å– templateId
    â†“
BuiltInTemplates.getTemplateById(templateId)
    â†“
HealthDataManager.getHealthRecords(templateId)
    â†“
Preferences API è¯»å– JSON
    â†“
è§£æä¸º HealthRecord[]
    â†“
é¡µé¢æ¸²æŸ“æ•°æ®
```

### 2. ä¿å­˜æ•°æ®æµ

```
ç”¨æˆ·å¡«å†™è¡¨å•
    â†“
è¡¨å•éªŒè¯
    â†“
åˆ›å»º HealthRecord å¯¹è±¡
    â†“
HealthDataManager.saveHealthRecord(record)
    â†“
è¯»å–ç°æœ‰è®°å½•åˆ—è¡¨
    â†“
è¿½åŠ æ–°è®°å½•
    â†“
åºåˆ—åŒ–ä¸º JSON
    â†“
Preferences API å­˜å‚¨
    â†“
è¿”å›æˆåŠŸæç¤º
```

## ğŸ—„ï¸ æ•°æ®å­˜å‚¨ç»“æ„

### Preferences å­˜å‚¨é”®å€¼

```typescript
// å¥åº·è®°å½•ï¼ˆæŒ‰æ¨¡æ¿åˆ†ç±»ï¼‰
health_records_thyroid: "[{...}, {...}]"; // ç”²äº¢æ•°æ®
health_records_diabetes: "[{...}, {...}]"; // ç³–å°¿ç—…æ•°æ®
health_records_hypertension: "[{...}, {...}]"; // é«˜è¡€å‹æ•°æ®ï¼ˆæ‰©å±•ï¼‰

// ç”¨è¯ç®¡ç†
medicine_list: "[{...}, {...}]"; // è¯å“åˆ—è¡¨
medicine_records: "[{...}, {...}]"; // ç”¨è¯è®°å½•
```

### æ•°æ®æ ¼å¼ç¤ºä¾‹

**å¥åº·è®°å½•**

```json
{
  "id": "1699999999999abc",
  "templateId": "thyroid",
  "groupId": "three",
  "date": 1699999999999,
  "indicators": {
    "tsh": 2.5,
    "ft3": 4.8,
    "ft4": 15.2
  },
  "note": "å¤æŸ¥ç»“æœ"
}
```

**è¯å“æ•°æ®**

```json
{
  "id": "1699999999999xyz",
  "name": "ä¼˜ç”²ä¹",
  "specification": "50Î¼g/ç‰‡",
  "dosage": "æ¯æ¬¡1ç‰‡",
  "frequency": ["morning"],
  "startDate": 1699999999999,
  "endDate": 1702591999999,
  "stock": 30,
  "note": "ç©ºè…¹æœç”¨"
}
```

## ğŸ¨ UI ç»„ä»¶å¤ç”¨

### åŠ¨æ€è¡¨å•ç”Ÿæˆ

æ ¹æ® `IndicatorType` è‡ªåŠ¨é€‰æ‹©æ§ä»¶ï¼š

```typescript
NUMBER  â†’  TextInput(type: InputType.Number) + Unit
SELECT  â†’  Row of SelectButtons
TEXT    â†’  TextInput(type: InputType.Normal)
```

### é¢œè‰²ç³»ç»Ÿ

æ ¹æ®æ•°æ®çŠ¶æ€åŠ¨æ€æ˜¾ç¤ºé¢œè‰²ï¼š

```typescript
normal   â†’  #4CAF50 (ç»¿è‰²)
warning  â†’  #FF9800 (æ©™è‰²)
danger   â†’  #F44336 (çº¢è‰²)
```

### å¡ç‰‡ç»„ä»¶

ç»Ÿä¸€çš„å¡ç‰‡æ ·å¼ï¼š

- ç™½è‰²èƒŒæ™¯
- 12px åœ†è§’
- 16px å†…è¾¹è·
- é˜´å½±æ•ˆæœ

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### 1. æ‡’åŠ è½½

- æ¨¡æ¿æŒ‰éœ€åŠ è½½
- æ•°æ®åˆ†é¡µæŸ¥è¯¢ï¼ˆæœªæ¥ï¼‰

### 2. ç¼“å­˜ç­–ç•¥

- æ¨¡æ¿åˆ—è¡¨ç¼“å­˜
- å•ä¾‹æ¨¡å¼é¿å…é‡å¤åˆ›å»º

### 3. æ•°æ®å­˜å‚¨ä¼˜åŒ–

- æŒ‰æ¨¡æ¿ ID åˆ†ç±»å­˜å‚¨
- é¿å…å…¨é‡è¯»å–

## ğŸ”® æœªæ¥æ‰©å±•æ–¹å‘

### 1. åŠ¨æ€æ¨¡æ¿åŠ è½½

```typescript
// ä»æœåŠ¡å™¨æˆ–é…ç½®æ–‡ä»¶åŠ è½½æ¨¡æ¿
TemplateLoader.loadFromConfig("templates.json");
```

### 2. è‡ªå®šä¹‰æ¨¡æ¿

```typescript
// ç”¨æˆ·åˆ›å»ºè‡ªå·±çš„ç–¾ç—…ç®¡ç†æ¨¡æ¿
CustomTemplateEditor.create();
```

### 3. æ•°æ®åˆ†æ

```typescript
// è¶‹åŠ¿å›¾ã€ç»Ÿè®¡åˆ†æ
DataAnalyzer.getTrend(templateId, indicatorId);
```

### 4. äº‘åŒæ­¥

```typescript
// æ•°æ®å¤‡ä»½åˆ°äº‘ç«¯
CloudSync.backup();
```

### 5. å¤šç”¨æˆ·æ”¯æŒ

```typescript
// å®¶åº­æˆå‘˜ç®¡ç†
UserManager.switchUser(userId);
```

## ğŸ“Š ä»£ç ç»Ÿè®¡

### æ–°æ¶æ„ä»£ç é‡

```
æ ¸å¿ƒæ–‡ä»¶:
â”œâ”€â”€ DiseaseTemplate.ets       (~150 è¡Œ)
â”œâ”€â”€ BuiltInTemplates.ets      (~200 è¡Œ)
â”œâ”€â”€ HealthDataManager.ets     (~180 è¡Œ)
â”œâ”€â”€ DiseaseManagePage.ets     (~250 è¡Œ)
â”œâ”€â”€ DataEntryPage.ets         (~200 è¡Œ)
â””â”€â”€ Index.ets (ä¿®æ”¹)          (~150 è¡Œ)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡: ~1130 è¡Œ

å¯æ”¯æŒ: æ— é™ä¸ªç–¾ç—…æ¨¡æ¿ âœ¨
```

### æ—§æ¶æ„ä»£ç é‡ï¼ˆ2 ä¸ªç–¾ç—…ï¼‰

```
ç–¾ç—…ç‰¹å®šæ–‡ä»¶:
â”œâ”€â”€ ThyroidManagePage.ets         (~200 è¡Œ)
â”œâ”€â”€ ThyroidDataEntryPage.ets      (~180 è¡Œ)
â”œâ”€â”€ DiabetesManagePage.ets        (~230 è¡Œ)
â”œâ”€â”€ DiabetesDataEntryPage.ets     (~190 è¡Œ)
â”œâ”€â”€ ThyroidData.ets               (~50 è¡Œ)
â”œâ”€â”€ DiabetesData.ets              (~60 è¡Œ)
â”œâ”€â”€ DataManager.ets               (~200 è¡Œ)
â””â”€â”€ Index.ets                     (~150 è¡Œ)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡: ~1260 è¡Œ

ä»…æ”¯æŒ: 2ä¸ªç–¾ç—…ï¼ˆæ¯å¢åŠ 1ä¸ªéœ€ +430 è¡Œï¼‰âŒ
```

### ç»“è®º

æ–°æ¶æ„ç”¨**æ›´å°‘çš„ä»£ç **å®ç°äº†**æ›´å¼ºçš„æ‰©å±•æ€§**ï¼ğŸ‰

---

**æ¶æ„è®¾è®¡åŸåˆ™ï¼š**

- âœ… é«˜å†…èšã€ä½è€¦åˆ
- âœ… å¼€é—­åŸåˆ™ï¼ˆå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼‰
- âœ… å•ä¸€èŒè´£
- âœ… DRYï¼ˆDon't Repeat Yourselfï¼‰
